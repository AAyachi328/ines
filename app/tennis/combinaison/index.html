<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Toutes les r√©partitions en groupes de 2/3/4</title>
  <style>
    :root{
      --main:#4f46e5; --bg:#f5f7ff; --card:#fff; --muted:#64748b; --danger:#ef4444;
      --ring: rgba(79,70,229,.25);
    }
    *{ box-sizing:border-box; }
    body{ font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:var(--bg); margin:0; padding:14px; color:#111; }
    .wrap{ max-width:1100px; margin:0 auto; }
    h1{ text-align:center; color:var(--main); margin:8px 0 14px; font-size:22px; }
    .card{ background:var(--card); border-radius:16px; padding:14px; margin-bottom:14px; box-shadow:0 10px 24px rgba(0,0,0,.06); }
    .top{ display:flex; gap:12px; align-items:flex-end; justify-content:space-between; flex-wrap:wrap; }
    .control{ min-width:180px; flex:1 1 220px; }
    label{ font-size:12px; font-weight:800; color:#1f2937; display:block; margin-bottom:6px; }
    input, select{
      width:100%; padding:11px 12px; border-radius:12px; border:1px solid #d7dbe7; font-size:15px; outline:none; background:#fff;
    }
    input:focus, select:focus{ border-color:var(--main); box-shadow:0 0 0 4px var(--ring); }
    .btns{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; flex:1 1 360px; }
    button{
      border:none; border-radius:12px; padding:11px 14px; font-size:14px; font-weight:800; cursor:pointer; color:#fff;
      flex:1 1 140px; min-width:140px;
    }
    button:hover{ opacity:.92; }
    .primary{ background:var(--main); }
    .secondary{ background:var(--muted); }
    .danger{ background:var(--danger); }

    .hint{ font-size:12px; color:#6b7280; margin-top:8px; }
    .error{ margin-top:10px; color:var(--danger); font-size:13px; font-weight:800; }

    .inputs{ display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap:10px; }
    @media (max-width:640px){
      .inputs{ grid-template-columns: 1fr; }
      button{ flex:1 1 100%; min-width:0; }
      h1{ font-size:20px; }
    }

    .meta{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
    .pill{ background:#eef2ff; border:1px solid #dbe2ff; color:#1f2a6b; padding:6px 10px; border-radius:999px; font-size:12px; font-weight:900; }

    .list{ margin-top:12px; display:flex; flex-direction:column; gap:10px; }
    .sol{ background:#fff; border:1px solid #e5e7eb; border-radius:14px; padding:10px 12px; }
    .sol .title{ font-weight:900; color:#111; margin-bottom:6px; font-size:13px; }
    .sol .groups{ color:#111; font-size:14px; line-height:1.35; }
    code{ background:#f3f4f6; padding:2px 6px; border-radius:8px; }
  </style>
</head>
<body>
<div class="wrap">
  <h1>üë• R√©partitions en groupes de 2 / 3 / 4</h1>

  <div class="card">
    <div class="top">
      <div class="control">
        <label for="size">Taille des groupes</label>
        <select id="size">
          <option value="2" selected>Groupes de 2</option>
          <option value="3">Groupes de 3</option>
          <option value="4">Groupes de 4</option>
        </select>
        <div class="hint">Le nombre de pr√©noms doit √™tre divisible par 2/3/4 (pas de ‚Äúreste‚Äù).</div>
      </div>

      <div class="control">
        <label for="limit">Limiter l‚Äôaffichage</label>
        <select id="limit">
          <option value="100" selected>100</option>
          <option value="250">250</option>
          <option value="500">500</option>
          <option value="1000">1000</option>
        </select>
        <div class="hint">On calcule tout, mais on n‚Äôaffiche que les premiers.</div>
      </div>

      <div class="btns">
        <button class="primary" id="go">G√©n√©rer</button>
        <button class="secondary" id="nettoyer">Nettoyer</button>
        <button class="secondary" id="ex">Exemple</button>
        <button class="danger" id="reset">Reset</button>
      </div>
    </div>

    <div class="error" id="error"></div>
  </div>

  <div class="card">
    <div class="inputs" id="inputs"></div>
    <div class="hint">Sauvegarde auto : tes pr√©noms restent m√™me si tu recharges la page.</div>
  </div>

  <div class="card" id="out" style="display:none;">
    <div class="meta">
      <div class="pill" id="pillTotal">Total: ‚Äî</div>
      <div class="pill" id="pillShown">Affich√©: ‚Äî</div>
      <div class="pill" id="pillInfo">‚Äî</div>
    </div>
    <div class="list" id="list"></div>
  </div>
</div>

<script>
  const MAX = 8;
  const LS_NAMES = "teams_names_v1";
  const LS_SIZE  = "teams_size_v1";
  const LS_LIMIT = "teams_limit_v1";

  const inputsEl = document.getElementById('inputs');
  const sizeEl = document.getElementById('size');
  const limitEl = document.getElementById('limit');
  const errorEl = document.getElementById('error');

  const outEl = document.getElementById('out');
  const listEl = document.getElementById('list');
  const pillTotal = document.getElementById('pillTotal');
  const pillShown = document.getElementById('pillShown');
  const pillInfo  = document.getElementById('pillInfo');

  function loadArr(key){
    try{
      const raw = localStorage.getItem(key);
      const v = raw ? JSON.parse(raw) : [];
      return Array.isArray(v) ? v : [];
    }catch{ return []; }
  }
  function saveArr(key, arr){ localStorage.setItem(key, JSON.stringify(arr)); }
  function loadStr(key, def){ return localStorage.getItem(key) || def; }
  function saveStr(key, v){ localStorage.setItem(key, String(v)); }

  function normalizeNames(arr){
    const cleaned = arr.map(v => (v||"").trim()).filter(Boolean).slice(0, MAX);
    // d√©doublonnage l√©ger (sinon ambigu)
    const seen = new Set();
    const uniq = [];
    for (const n of cleaned){
      const k = n.toLowerCase();
      if (!seen.has(k)){ seen.add(k); uniq.push(n); }
    }
    return uniq;
  }

  function makeInputs(){
    const saved = loadArr(LS_NAMES);
    inputsEl.innerHTML = '';
    for (let i=0;i<MAX;i++){
      const d = document.createElement('div');
      const lab = document.createElement('label');
      lab.textContent = `Pr√©nom ${i+1}`;
      const inp = document.createElement('input');
      inp.type = 'text';
      inp.placeholder = 'Ex: Alex';
      inp.value = saved[i] || '';
      inp.addEventListener('input', () => {
        const arr = loadArr(LS_NAMES);
        while (arr.length < MAX) arr.push("");
        arr[i] = inp.value;
        saveArr(LS_NAMES, arr);
      });
      d.appendChild(lab);
      d.appendChild(inp);
      inputsEl.appendChild(d);
    }
  }

  function getNames(){
    const raw = loadArr(LS_NAMES);
    return normalizeNames(raw);
  }

  function clearOutput(){
    outEl.style.display = 'none';
    listEl.innerHTML = '';
    pillTotal.textContent = 'Total: ‚Äî';
    pillShown.textContent = 'Affich√©: ‚Äî';
    pillInfo.textContent = '‚Äî';
  }

  // G√©n√®re toutes les partitions en groupes de taille m (groupes sans ordre)
  // Principe: on prend le plus petit indice restant, on choisit (m-1) partenaires parmi les restants.
  function* partitionsFixedSize(n, m){
    const remaining = [];
    for (let i=0;i<n;i++) remaining.push(i);

    function* rec(rem, current){
      if (rem.length === 0){
        yield current.map(g => g.slice());
        return;
      }
      const first = rem[0];
      const rest = rem.slice(1);

      // choisir m-1 √©l√©ments dans rest
      function* comb(start, need, chosen){
        if (need === 0){
          const group = [first, ...chosen];
          // construire nouveau rem = rest sans chosen
          const chosenSet = new Set(chosen);
          const newRem = rest.filter(x => !chosenSet.has(x));
          current.push(group);
          yield* rec(newRem, current);
          current.pop();
          return;
        }
        for (let i=start; i<=rest.length-need; i++){
          chosen.push(rest[i]);
          yield* comb(i+1, need-1, chosen);
          chosen.pop();
        }
      }

      yield* comb(0, m-1, []);
    }

    yield* rec(remaining, []);
  }

  function formatSolution(sol, names){
    // sol = [[idx...], [idx...], ...]
    return sol.map(g => g.map(i => names[i]).join(', '));
  }

  document.getElementById('go').addEventListener('click', () => {
    errorEl.textContent = '';
    clearOutput();

    const names = getNames();
    const n = names.length;
    const m = parseInt(sizeEl.value, 10);
    const limit = parseInt(limitEl.value, 10);

    if (n === 0){
      errorEl.textContent = "Ajoute au moins 1 pr√©nom.";
      return;
    }
    if (n > MAX){
      errorEl.textContent = `Maximum ${MAX} pr√©noms.`;
      return;
    }
    if (n < m){
      errorEl.textContent = `Il faut au moins ${m} pr√©noms pour faire des groupes de ${m}.`;
      return;
    }
    if (n % m !== 0){
      errorEl.textContent = `Impossible sans ‚Äúreste‚Äù : ${n} pr√©noms n‚Äôest pas divisible par ${m}.`;
      return;
    }

    // Affichage
    outEl.style.display = 'block';
    pillInfo.textContent = `${n} pr√©noms ‚Üí ${n/m} groupe(s) de ${m}`;

    // G√©n√©ration (compte total + affiche les premiers)
    let total = 0;
    let shown = 0;
    let idx = 0;

    for (const sol of partitionsFixedSize(n, m)){
      total++;
      if (shown < limit){
        const groupsTxt = formatSolution(sol, names);
        const div = document.createElement('div');
        div.className = 'sol';
        div.innerHTML = `
          <div class="title">R√©partition ${(++idx).toLocaleString('fr-FR')}</div>
          <div class="groups">${groupsTxt.map((t,i)=>`<div><code>G${i+1}</code> ${t}</div>`).join('')}</div>
        `;
        listEl.appendChild(div);
        shown++;
      }
    }

    pillTotal.textContent = `Total: ${total.toLocaleString('fr-FR')}`;
    pillShown.textContent = `Affich√©: ${shown.toLocaleString('fr-FR')} / ${total.toLocaleString('fr-FR')}`;

    if (total > limit){
      errorEl.textContent = `Il y a ${total.toLocaleString('fr-FR')} r√©partitions. J‚Äôaffiche seulement les ${limit.toLocaleString('fr-FR')} premi√®res.`;
    }
  });

  document.getElementById('nettoyer').addEventListener('click', () => {
    const names = normalizeNames(loadArr(LS_NAMES));
    const arr = names.concat(Array(MAX - names.length).fill(""));
    saveArr(LS_NAMES, arr);
    makeInputs();
    errorEl.textContent = '';
    clearOutput();
  });

  document.getElementById('ex').addEventListener('click', () => {
    // exemple qui marche pour groupes de 2 (8 pr√©noms)
    const ex = ["Alice","Beno√Æt","Chlo√©","Dylan","Emma","Farid","In√®s","Jules"];
    saveArr(LS_NAMES, ex);
    sizeEl.value = "2";
    limitEl.value = "250";
    saveStr(LS_SIZE, "2");
    saveStr(LS_LIMIT, "250");
    makeInputs();
    errorEl.textContent = '';
    clearOutput();
  });

  document.getElementById('reset').addEventListener('click', () => {
    localStorage.removeItem(LS_NAMES);
    localStorage.removeItem(LS_SIZE);
    localStorage.removeItem(LS_LIMIT);
    location.reload();
  });

  // init prefs
  sizeEl.value = loadStr(LS_SIZE, "2");
  limitEl.value = loadStr(LS_LIMIT, "100");
  sizeEl.addEventListener('change', () => { saveStr(LS_SIZE, sizeEl.value); clearOutput(); });
  limitEl.addEventListener('change', () => { saveStr(LS_LIMIT, limitEl.value); clearOutput(); });

  makeInputs();
</script>
</body>
</html>